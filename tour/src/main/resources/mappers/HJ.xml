<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.tour.HJMapper">
	<select id="hjBoardTotal" resultType="int">
		select count(*) from Board
	</select>
	<!-- 검색 안 하는 경우 -->	
	<select id="hjBoardList1_old" parameterType="Board" resultType="Board">
	  select *
		from (
		   	  select rownum rn, a.*
		  	  from (select b.* , m.m_nickname, m.m_active_kind
                    from   board b, member m 
                    where b.m_id = m.m_id
                    order by b_date desc, b_no) a
		     )
		where rn between #{start} and #{end}
	</select>
	<select id="hjBoardList2_old" parameterType="Board" resultType="Board">
	    select *
		from (
		   	  select rownum rn, a.*
		  	  from (select b.* , m.m_nickname, m.m_active_kind
                    from   board b, member m 
                    where b.m_id = m.m_id
                    and b_kind = #{b_kind}   
                    order by b_date desc, b_no) a
		     )
		where rn between #{start} and #{end}
	</select>
	
	<!-- 검색하는 경우 -->
	<select id="hjBoardList1" parameterType="Board" resultType="Board">
		  select *
			from (
			   	  select rownum rn, a.*
			  	  from (select b.* , m.m_nickname, m.m_active_kind
	                    from   board b, member m 
	                    where b.m_id = m.m_id
	                    <choose>
						 	 <when test="searchType == 'b_title'">
						    		AND b_title like '%' || #{keyword} || '%'    
						   	 </when>
						 	 <when test="searchType == 'b_contents'">
						    		AND b_contents like '%' || #{keyword} || '%'    
						   	 </when>
						   	 <otherwise>
						   	  	    AND m_nickname like '%' || #{keyword} || '%'   
							 </otherwise>
					    </choose>
	                    order by b_date desc, b_no) a
			     )
			where rn between #{start} and #{end}
	</select>
	<select id="hjBoardList2" parameterType="Board" resultType="Board">
	    select *
		from (
		   	  select rownum rn, a.*
		  	  from (select b.* , m.m_nickname, m.m_active_kind
                    from   board b, member m 
                    where b.m_id = m.m_id
                   	<choose>
					 	 <when test="b_kind == 1 and searchType == 'b_title'">
					    		AND b_kind = 1
					    		AND b_title like '%' || #{keyword} || '%'    
					   	 </when>
					 	 <when test="b_kind == 1 and searchType == 'b_contents'">
					    		AND b_kind = 1
					    		AND b_contents like '%' || #{keyword} || '%'    
					   	 </when>
					 	 <when test="b_kind == 1 and searchType == 'm_nickname'">
					    		AND b_kind = 1
					    		AND m_nickname like '%' || #{keyword} || '%'    
					   	 </when>
					   	 
					 	 <when test="b_kind == 2 and searchType == 'b_title'">
					    		AND b_kind = 2
					    		AND b_title like '%' || #{keyword} || '%'    
					   	 </when>
					 	 <when test="b_kind == 2 and searchType == 'b_contents'">
					    		AND b_kind = 2
					    		AND b_contents like '%' || #{keyword} || '%'    
					   	 </when>
					 	 <when test="b_kind == 2 and searchType == 'm_nickname'">
					    		AND b_kind = 2
					    		AND m_nickname like '%' || #{keyword} || '%'    
					   	 </when>
					   	 
					 	 <when test="b_kind == 3 and searchType == 'b_title'">
					    		AND b_kind = 3
					    		AND b_title like '%' || #{keyword} || '%'    
					   	 </when>
					 	 <when test="b_kind == 3 and searchType == 'b_contents'">
					    		AND b_kind = 3
					    		AND b_contents like '%' || #{keyword} || '%'    
					   	 </when>
					 	 <otherwise>
					    		AND b_kind = 3
					    		AND m_nickname like '%' || #{keyword} || '%'    
					   	 </otherwise>
					</choose>
                    order by b_date desc, b_no) a
		     )
		where rn between #{start} and #{end}
	</select>

	
	<select id="hjBoardDetail" parameterType="Board" resultType="Board">
		select b.*, m.m_nickname, m.m_active_kind
		from board b, member m
		where b.m_id = m.m_id
		and b.b_kind = #{b_kind}
		and b.b_no = #{b_no}
	</select>
	
	<select id="hjNicknameSelect" parameterType="java.lang.String" resultType="java.lang.String">
		select m_nickname from member where m_id = #{m_id}
	</select>
	
	<insert id="hjBoardInsert" parameterType="Board">
<!-- 		<selectKey keyProperty="b_no_seq" resultType="int" order="BEFORE"> -->
<!-- 			select b_no_seq.nextval from dual -->
<!-- 		</selectKey> -->
<!-- 		<selectKey keyProperty="b_group_seq" resultType="int" order="BEFORE"> -->
<!-- 			select b_group_seq.nextval from dual -->
<!-- 		</selectKey> -->
		insert into board values(#{b_kind}, b_no_seq, #{m_id}, #{b_title}, #{b_contents}, sysdate, 0,
								 #{b_filename}, b_group_seq, 0, 0, #{b_notice}, #{b_lock}, null)
	</insert>
	
</mapper>